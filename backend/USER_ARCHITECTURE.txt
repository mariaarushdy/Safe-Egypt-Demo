â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    SAFE EGYPT - USER AUTHENTICATION SYSTEM                     â•‘
â•‘                              Architecture Overview                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              USER TYPES & ROLES                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     MOBILE USERS         â”‚              â”‚      DASHBOARD USERS             â”‚
â”‚   (user_type=mobile)     â”‚              â”‚    (user_type=dashboard)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                          â”‚              â”‚                                  â”‚
â”‚  Role: USER              â”‚              â”‚  Role: ADMIN                     â”‚
â”‚  âœ“ Report incidents      â”‚              â”‚  âœ“ Full system access            â”‚
â”‚  âœ“ Upload media          â”‚              â”‚  âœ“ Manage all users              â”‚
â”‚  âœ“ View own reports      â”‚              â”‚  âœ“ System configuration          â”‚
â”‚  âœ“ Get notifications     â”‚              â”‚  âœ“ All analytics                 â”‚
â”‚  âœ“ Update profile        â”‚              â”‚  âœ“ Audit logs                    â”‚
â”‚                          â”‚              â”‚                                  â”‚
â”‚  Registration:           â”‚              â”‚  Role: MODERATOR                 â”‚
â”‚  â€¢ Self-service          â”‚              â”‚  âœ“ View all incidents            â”‚
â”‚  â€¢ Email verification    â”‚              â”‚  âœ“ Verify/reject reports         â”‚
â”‚  â€¢ Phone verification    â”‚              â”‚  âœ“ Manage mobile users           â”‚
â”‚                          â”‚              â”‚  âœ“ Update incident status        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚  âœ“ Analytics                     â”‚
                                          â”‚                                  â”‚
                                          â”‚  Role: OPERATOR                  â”‚
                                          â”‚  âœ“ View all incidents            â”‚
                                          â”‚  âœ“ Update incident status        â”‚
                                          â”‚  âœ“ Add notes                     â”‚
                                          â”‚  âœ“ Basic analytics               â”‚
                                          â”‚                                  â”‚
                                          â”‚  Registration:                   â”‚
                                          â”‚  â€¢ Created by Admin              â”‚
                                          â”‚  â€¢ Auto-verified                 â”‚
                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          AUTHENTICATION FLOW                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

REGISTRATION (Mobile)                      LOGIN (Mobile or Dashboard)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. User submits credentials              1. User submits credentials
   â†“                                        â†“
2. Validate input data                   2. Query database for user
   â†“                                        â†“
3. Check username/email unique           3. Verify password hash
   â†“                                        â†“
4. Hash password (werkzeug)              4. Check user is_active
   â†“                                        â†“
5. Insert into database                  5. Update last_login
   â†“                                        â†“
6. Generate JWT tokens                   6. Generate JWT tokens
   â€¢ Access Token (24h)                     â€¢ Access Token (24h)
   â€¢ Refresh Token (30d)                    â€¢ Refresh Token (30d)
   â†“                                        â†“
7. Return user + tokens                  7. Return user + tokens


PROTECTED REQUEST
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. Client: Authorization: Bearer <token>
   â†“
2. Extract token from header
   â†“
3. Verify token signature (JWT)
   â†“
4. Check token expiration
   â†“
5. Extract payload (user_id, role, etc.)
   â†“
6. Query database for user
   â†“
7. Verify user is_active
   â†“
8. Check permissions (role/user_type)
   â†“
9. âœ… Allow request OR âŒ Reject (401/403)


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                             DATABASE SCHEMA                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TABLE: users                                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  id                  SERIAL PRIMARY KEY                                    â”‚
â”‚  username            VARCHAR(100) UNIQUE NOT NULL     [indexed]           â”‚
â”‚  email               VARCHAR(255) UNIQUE NOT NULL     [indexed]           â”‚
â”‚  password_hash       VARCHAR(255) NOT NULL                                â”‚
â”‚  full_name           VARCHAR(255)                                         â”‚
â”‚  phone_number        VARCHAR(20)                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ user_type        VARCHAR(20) NOT NULL DEFAULT 'mobile'  [indexed]   â”‚ â”‚
â”‚  â”‚                  â€¢ 'mobile'    â†’ Mobile app users                    â”‚ â”‚
â”‚  â”‚                  â€¢ 'dashboard' â†’ Admin/staff users                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ role             VARCHAR(20) NOT NULL DEFAULT 'user'                 â”‚ â”‚
â”‚  â”‚                  â€¢ 'user'      â†’ Mobile user                         â”‚ â”‚
â”‚  â”‚                  â€¢ 'operator'  â†’ Dashboard viewer                    â”‚ â”‚
â”‚  â”‚                  â€¢ 'moderator' â†’ Dashboard manager                   â”‚ â”‚
â”‚  â”‚                  â€¢ 'admin'     â†’ System administrator                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  is_active           BOOLEAN DEFAULT TRUE                                  â”‚
â”‚  is_verified         BOOLEAN DEFAULT FALSE                                 â”‚
â”‚  created_at          TIMESTAMP DEFAULT CURRENT_TIMESTAMP                   â”‚
â”‚  updated_at          TIMESTAMP DEFAULT CURRENT_TIMESTAMP                   â”‚
â”‚  last_login          TIMESTAMP                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†‘
         â”‚ (Foreign Key)
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TABLE: incidents                                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  incident_id         UUID PRIMARY KEY                                      â”‚
â”‚  reporter_id         INT REFERENCES users(id) â† Links to users            â”‚
â”‚  is_anonymous        BOOLEAN DEFAULT FALSE                                 â”‚
â”‚  category            TEXT                                                  â”‚
â”‚  title               TEXT                                                  â”‚
â”‚  description         TEXT                                                  â”‚
â”‚  severity            TEXT                                                  â”‚
â”‚  status              TEXT                                                  â”‚
â”‚  verified            TEXT                                                  â”‚
â”‚  detected_events     JSONB                                                 â”‚
â”‚  timestamp           TIMESTAMP                                             â”‚
â”‚  location_id         INT REFERENCES locations(id)                          â”‚
â”‚  ...                 (other incident fields)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          JWT TOKEN STRUCTURE                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ACCESS TOKEN (expires: 24 hours)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Header:
  {
    "alg": "HS256",
    "typ": "JWT"
  }

Payload:
  {
    "user_id": 123,
    "username": "john_doe",
    "email": "john@example.com",
    "user_type": "mobile",      â† Determines access method
    "role": "user",             â† Determines permissions
    "iat": 1234567890,          â† Issued at
    "exp": 1234654290           â† Expires at (24h later)
  }

Signature:
  HMACSHA256(
    base64UrlEncode(header) + "." + base64UrlEncode(payload),
    SECRET_KEY
  )


REFRESH TOKEN (expires: 30 days)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Payload:
  {
    "user_id": 123,
    "username": "john_doe",
    "email": "john@example.com",
    "user_type": "mobile",
    "role": "user",
    "type": "refresh",          â† Indicates refresh token
    "iat": 1234567890,
    "exp": 1237159890           â† Expires at (30d later)
  }


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           FILE STRUCTURE                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

backend/
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ setup_db.py               âœï¸  Creates users table + default admin
â”‚   â””â”€â”€ database.py               âœï¸  SQLAlchemy User model + enums
â”‚
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ auth.py                   âœ¨  NEW - Authentication service
â”‚   â”‚   â”œâ”€â”€ AuthService          â†’ JWT tokens, password hashing
â”‚   â”‚   â”œâ”€â”€ UserService          â†’ User CRUD operations
â”‚   â”‚   â””â”€â”€ get_current_user_from_token()
â”‚   â”‚
â”‚   â”œâ”€â”€ USER_AUTH_README.md      ğŸ“–  Complete documentation
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ test_user_auth.py            âœ¨  NEW - Comprehensive test script
â”œâ”€â”€ USER_SYSTEM_SETUP.md         ğŸ“–  Setup guide
â”œâ”€â”€ USER_SYSTEM_SUMMARY.md       ğŸ“–  Quick reference
â”œâ”€â”€ USER_ARCHITECTURE.txt        ğŸ“–  This file
â”œâ”€â”€ env_template.txt             ğŸ“–  Environment variables template
â”œâ”€â”€ requirements.txt             âœï¸  Added werkzeug + PyJWT
â””â”€â”€ .env                         âš™ï¸  Your configuration (create this!)


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            API ENDPOINTS                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

MOBILE APP ENDPOINTS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
POST   /api/mobile/register              Create mobile user account
       Body: {username, email, password, full_name?, phone_number?}
       Returns: {user, tokens}

POST   /api/mobile/login                 Authenticate mobile user
       Body: {username, password}
       Returns: {user, tokens}

GET    /api/mobile/profile               Get user profile
       Headers: Authorization: Bearer <token>
       Returns: {user}

PUT    /api/mobile/profile               Update profile
       Headers: Authorization: Bearer <token>
       Body: {full_name?, phone_number?}

POST   /api/mobile/change-password       Change password
       Headers: Authorization: Bearer <token>
       Body: {old_password, new_password}

POST   /api/mobile/verify-email          Verify email address
       Headers: Authorization: Bearer <token>
       Body: {verification_code}


DASHBOARD ENDPOINTS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
POST   /api/dashboard/login              Authenticate dashboard user
       Body: {username, password}
       Returns: {user, tokens}

GET    /api/dashboard/profile            Get admin profile
       Headers: Authorization: Bearer <token>
       Returns: {user}

POST   /api/dashboard/users              Create dashboard user (admin only)
       Headers: Authorization: Bearer <token>
       Body: {username, email, password, full_name, role}
       Returns: {user}

GET    /api/dashboard/users              List all users (admin/moderator)
       Headers: Authorization: Bearer <token>
       Query: ?user_type=mobile&role=user&page=1&limit=20
       Returns: {users[], total, page, limit}

GET    /api/dashboard/users/:id          Get user details (admin/moderator)
       Headers: Authorization: Bearer <token>
       Returns: {user}

PUT    /api/dashboard/users/:id          Update user (admin)
       Headers: Authorization: Bearer <token>
       Body: {full_name?, role?, is_active?}

DELETE /api/dashboard/users/:id          Deactivate user (admin)
       Headers: Authorization: Bearer <token>


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ROLE PERMISSIONS MATRIX                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Action                         â”‚ User  â”‚ Operator â”‚ Moderator â”‚ Admin â”‚
                              â”‚(mobile)â”‚(dashboardâ”‚(dashboard)â”‚(dashb)â”‚
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤
Report Incident               â”‚   âœ…   â”‚    âŒ    â”‚     âŒ    â”‚   âŒ  â”‚
View Own Reports              â”‚   âœ…   â”‚    âŒ    â”‚     âŒ    â”‚   âŒ  â”‚
Upload Media                  â”‚   âœ…   â”‚    âŒ    â”‚     âŒ    â”‚   âŒ  â”‚
Receive Notifications         â”‚   âœ…   â”‚    âŒ    â”‚     âŒ    â”‚   âŒ  â”‚
Update Own Profile            â”‚   âœ…   â”‚    âœ…    â”‚     âœ…    â”‚   âœ…  â”‚
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤
View All Incidents            â”‚   âŒ   â”‚    âœ…    â”‚     âœ…    â”‚   âœ…  â”‚
Update Incident Status        â”‚   âŒ   â”‚    âœ…    â”‚     âœ…    â”‚   âœ…  â”‚
Add Notes/Comments            â”‚   âŒ   â”‚    âœ…    â”‚     âœ…    â”‚   âœ…  â”‚
View Analytics                â”‚   âŒ   â”‚    âœ…    â”‚     âœ…    â”‚   âœ…  â”‚
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤
Verify/Reject Reports         â”‚   âŒ   â”‚    âŒ    â”‚     âœ…    â”‚   âœ…  â”‚
Manage Mobile Users           â”‚   âŒ   â”‚    âŒ    â”‚     âœ…    â”‚   âœ…  â”‚
View User Details             â”‚   âŒ   â”‚    âŒ    â”‚     âœ…    â”‚   âœ…  â”‚
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤
Manage Dashboard Users        â”‚   âŒ   â”‚    âŒ    â”‚     âŒ    â”‚   âœ…  â”‚
System Configuration          â”‚   âŒ   â”‚    âŒ    â”‚     âŒ    â”‚   âœ…  â”‚
View Audit Logs               â”‚   âŒ   â”‚    âŒ    â”‚     âŒ    â”‚   âœ…  â”‚
Delete Users                  â”‚   âŒ   â”‚    âŒ    â”‚     âŒ    â”‚   âœ…  â”‚


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          SECURITY FEATURES                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ…  Password Hashing             â†’ werkzeug.security (pbkdf2:sha256)
âœ…  JWT Tokens                   â†’ PyJWT with HS256 algorithm
âœ…  Token Expiration             â†’ Access: 24h, Refresh: 30d
âœ…  User Type Separation         â†’ Mobile users can't access dashboard
âœ…  Role-Based Authorization     â†’ 4 levels: user, operator, moderator, admin
âœ…  Account Status               â†’ Can deactivate users (is_active)
âœ…  Email Verification           â†’ Support for is_verified flag
âœ…  Last Login Tracking          â†’ Audit trail for user activity
âœ…  Secure Secret Key            â†’ Environment variable, not hardcoded
âœ…  SQL Injection Protection     â†’ Parameterized queries
âœ…  Anonymous Reporting          â†’ Optional user_id in incidents


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          QUICK START GUIDE                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. INSTALL DEPENDENCIES
   $ pip install -r requirements.txt

2. SETUP ENVIRONMENT
   $ copy env_template.txt .env          # Windows
   $ cp env_template.txt .env            # Linux/Mac
   
   Edit .env:
   - Add database credentials
   - Generate SECRET_KEY: python -c "import secrets; print(secrets.token_urlsafe(32))"

3. CREATE DATABASE
   $ python models/setup_db.py
   
   This creates:
   âœ“ users table
   âœ“ Default admin (username: admin, password: Admin@123)
   âœ“ All other tables

4. TEST THE SYSTEM
   $ python test_user_auth.py
   
   Tests all authentication features

5. START USING
   - Import AuthService and UserService
   - Create API endpoints
   - Add authentication middleware
   - Implement role-based authorization

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              DEFAULT ADMIN                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ” Username:   admin
ğŸ“§ Email:      admin@safeegypt.com
ğŸ”’ Password:   Admin@123
âš¡ Role:       admin
ğŸ“± Type:       dashboard
âœ… Status:     Active & Verified

âš ï¸  IMPORTANT: Change this password immediately after first login!


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           DOCUMENTATION FILES                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“„ USER_SYSTEM_SETUP.md           â†’ Complete setup guide with code examples
ğŸ“„ services/USER_AUTH_README.md   â†’ Detailed API docs, Flask examples, best practices
ğŸ“„ USER_SYSTEM_SUMMARY.md         â†’ Quick reference card
ğŸ“„ USER_ARCHITECTURE.txt          â†’ This architecture diagram
ğŸ“„ env_template.txt               â†’ Environment variables template


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                              YOU'RE ALL SET! ğŸ‰                                â•‘
â•‘                                                                                â•‘
â•‘  The user authentication system is fully implemented and ready to use.         â•‘
â•‘  See the documentation files for detailed usage instructions.                  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

